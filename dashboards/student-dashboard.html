<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Student Dashboard | E-School</title>
  <link rel="stylesheet" href="../css/style.css" />
  <style>
    body {
      display: none; /* Hide content until user is verified */
    }

    .dashboard-header {
      background-color: #e0f8e9;
      padding: 1.5rem;
      text-align: center;
      border-bottom: 1px solid #ccc;
    }

    .header-content h2 {
      margin: 0.5rem 0;
    }

    .tagline {
      font-size: 1rem;
      color: #555;
    }

    .progress-bar-container {
      width: 100%;
      height: 20px;
      background-color: #f0f0f0;
      border-radius: 10px;
      overflow: hidden;
      margin: 1rem 0;
    }

    .progress-bar-fill {
      height: 100%;
      width: 0%;
      background-color: #82c682;
      transition: width 0.3s ease;
    }

    .grid {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      margin-top: 2rem;
    }

    .card {
      flex: 1 1 45%;
      background: white;
      border-radius: 10px;
      padding: 1rem;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }

    .checkmark {
      margin-left: 10px;
      color: green;
    }

    .complete-btn {
      margin-top: 10px;
      background-color: #d7edcf;
      border: none;
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
    }

    #logout-btn {
      margin-top: 1rem;
      background-color: #f8d7da;
      border: none;
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
    }
  </style>
</head>

<body>
  <!-- Navbar placeholder -->
  <div id="main-header"></div>

  <header class="dashboard-header">
    <div class="header-content">
      <h2>Welcome to Your Dashboard</h2>
      <p class="tagline">Ontario Curriculum-Based Online Learning</p>
      <h2 id="welcome">Welcome, Rhahavy</h2>
      <button id="logout-btn">Logout</button>
    </div>
  </header>

  <main>
    <section class="course-overview">
      <p>You’re successfully logged in.</p>
      <p>Here you’ll find links to your assignments, grades, and course progress.</p>

      <section class="progress-section">
        <p id="progress-text">Loading progress...</p>
        <div class="progress-bar-container">
          <div class="progress-bar-fill" id="progress-fill"></div>
        </div>
      </section>

      <div class="grid">
        <div class="card" data-lesson-id="grade6-science">
          <h4>
            <a href="../courses/Grade6/Science/grade6-science.html">Go to Grade 6 Science</a>
            <span class="checkmark" style="display: none;">✅</span>
          </h4>
          <p>Continue lessons or submit your assignments.</p>
          <button class="complete-btn">Mark Complete</button>
        </div>

        <div class="card" data-lesson-id="assignment1-rock-layers">
          <h4>
            <a href="../courses/Grade6/Science/assignment1-rock-layers.html">Assignment 1</a>
            <span class="checkmark" style="display: none;">✅</span>
          </h4>
          <p>Submit your rock layer diagram.</p>
          <button class="complete-btn">Mark Complete</button>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <p>&copy; 2025 E-School | Made with ❤️ in Ontario</p>
  </footer>

  <!-- ✅ Auth + Role + Navbar Injection -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT.firebaseapp.com",
      projectId: "YOUR_PROJECT_ID"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    fetch("../components/nav.html")
      .then(res => res.text())
      .then(data => {
        document.getElementById("main-header").innerHTML = data;

        const navbar = document.getElementById("navbar");
        if (navbar) navbar.style.display = "none";

        onAuthStateChanged(auth, async (user) => {
          if (user) {
            const docRef = doc(db, "users", user.uid);
            const docSnap = await getDoc(docRef);

            if (docSnap.exists()) {
              const role = docSnap.data().role;

              if (role === "student") {
                if (navbar) navbar.style.display = "flex";
                document.body.style.display = "block";
              } else if (role === "admin") {
                window.location.href = "/eschool/dashboards/admin-dashboard.html";
              } else {
                window.location.href = "/eschool/index.html";
              }
            } else {
              window.location.href = "/eschool/index.html";
            }
          } else {
            window.location.href = "/eschool/index.html";
          }
        });
      });

    // Logout button
    document.addEventListener("click", (e) => {
      if (e.target.id === "logout-btn") {
        signOut(auth).then(() => {
          window.location.href = "/eschool/index.html";
        });
      }
    });
  </script>

  <!-- ✅ Student Dashboard Functionality -->
  <script type="module" src="student-dashboard.js"></script>
</body>
</html>
